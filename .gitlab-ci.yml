workflow:
  rules:
    - if: $CI_MERGE_REQUEST_IID
    - if: $CI_COMMIT_TAG
    - if: '$CI_COMMIT_BRANCH == "devel"'

variables:
  UPSTREAM_REMOTE_URL: "https://github.com/micahflee/torbrowser-launcher"
  UPSTREAM_BRANCH: "develop"
  DOC_URL: "https://tails.boum.org/contribute/release_process/tor-browser/AppArmor_policy/"

image: debian:bullseye

before_script:
  - export DEBIAN_FRONTEND=noninteractive
  - apt-get update -qq

is-up-to-date-wrt-upstream:
  script:
    - apt-get -qy install git ca-certificates
    - git remote set-url upstream-repo "$UPSTREAM_REMOTE_URL" || git remote add upstream-repo "$UPSTREAM_REMOTE_URL"
    - git fetch --verbose upstream-repo "refs/heads/$UPSTREAM_BRANCH"
    - 'if test "$(git log --oneline ..upstream-repo/$UPSTREAM_BRANCH -- apparmor/ | wc -l)" -gt 0 ; then echo "We need to merge upstream changes: $DOC_URL" ; exit 1 ; fi'
